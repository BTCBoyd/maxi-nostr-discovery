name: Nostr Discovery for Maxi (Manual Seed)
on:
  schedule:
    - cron: '*/30 * * * *'  # Every 30 minutes - check for new opportunities
  workflow_dispatch:
  push:
    paths:
      - 'seed-opportunities.txt'

jobs:
  process:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Process Manual Seeds
        run: |
          # Create seed file if doesn't exist
          touch seed-opportunities.txt
          
          # Convert note IDs to JSON format
          echo '{"last_updated": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'", "opportunities": [' > opportunities.json
          
          first=true
          while IFS= read -r line || [ -n "$line" ]; do
            # Skip empty lines and comments
            [[ -z "$line" || "$line" =~ ^# ]] && continue
            
            if [ "$first" = true ]; then
              first=false
            else
              echo "," >> opportunities.json
            fi
            
            # Simple JSON object for each note ID
            echo "  {\"id\": \"$line\", \"source\": \"manual\"}" >> opportunities.json
          done < seed-opportunities.txt
          
          echo ']}'  >> opportunities.json
          
          cat opportunities.json
          
      - name: Commit Results
        run: |
          git config user.name "Maxi Discovery Bot"
          git config user.email "maxi@arcadiab.com"
          git add opportunities.json
          git diff --staged --quiet || git commit -m "Update opportunities $(date -u +%Y-%m-%d_%H:%M)"
          git push || echo "No changes"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
